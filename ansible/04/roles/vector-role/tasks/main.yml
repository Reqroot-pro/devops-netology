---
- name: Install prerequisites
  ansible.builtin.apt:
    name:
      - ca-certificates
      - curl
    state: present

- name: Get system architecture (e.g., amd64, arm64)
  ansible.builtin.command: dpkg --print-architecture
  register: vector_arch
  changed_when: false

- name: Download Vector .deb package from official APT repo
  ansible.builtin.get_url:
    url: "https://apt.vector.dev/pool/v/ve/vector_{{ vector_version }}_{{ vector_arch.stdout }}.deb"
    dest: "{{ vector_tmp_path }}"
    mode: '0644'

- name: Install Vector via dpkg
  ansible.builtin.apt:
    deb: "{{ vector_tmp_path }}"

- name: Enable and start Vector
  ansible.builtin.systemd:
    name: "{{ vector_service_name }}"
    enabled: true
    state: started
    daemon_reload: true
